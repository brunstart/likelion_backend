# AWS EC2
## 인바운드 규칙
- 접속할 때 필요한 규칙 설정 가능

## SSH를 통한 접속
### macOS/Linux
```
# 1. 키 파일 권한 설정 (최초 1회)
chmod 400 ~/Downloads/spring-boot-key.pem

# 2. SSH 접속
ssh -i ~/Downloads/spring-boot-key.pem ec2-user@<EC2_PUBLIC_IP>
```

### Windows(PowerShell)
```
# 로그인 시도 시 permission denied 됐을 경우
# 1. 상속된 권한 제거 (기존 권한 초기화)
icacls.exe "lion-key.pem" /reset

# 2. 현재 사용자에게만 '읽기(Read)' 권한 부여
icacls.exe "lion-key.pem" /grant:r "$($env:USERNAME):R"

# 3. 상속 권한 차단 (다른 사용자 접근 불가)
icacls.exe "lion-key.pem" /inheritance:r

# SSH 접속
ssh -i C:\Users\YourName\Downloads\spring-boot-key.pem ec2-user@<EC2_PUBLIC_IP>
```

# Spring Boot 애플리케이션 배포
## 로컬에서 JAR 파일 빌드
### 개발 환경에서 실행:
```
# 프로젝트 디렉토리로 이동
cd /path/to/your-spring-project

# Gradle로 빌드 (테스트 제외)
./gradlew clean build -x test
```
### 생성된 JAR 파일 위치:
```
build/libs/your-app-0.0.1-SNAPSHOT.jar
```

## EC2 서버로 JAR 파일 전송
```
scp -i C:\Users\YourName\Downloads\spring-boot-key.pem `
    build\libs\your-app-0.0.1-SNAPSHOT.jar `
    ec2-user@<EC2_PUBLIC_IP>:/home/ec2-user/app/
```

## JAR 파일 실행
```
java -jar your-app-0.0.1-SNAPSHOT.jar
```
### 방법 2: nohup을 이용한 백그라운드 실행
```
# 애플리케이션 실행
nohup java -jar your-app-0.0.1-SNAPSHOT.jar > app.log 2>&1 &
```
#### 명령어 설명:
- nohup: SSH 세션 종료 후에도 프로세스 유지
- \> app.log: 표준 출력을 app.log 파일로 리다이렉트
- 2>&1: 표준 에러도 표준 출력으로 리다이렉트
- &: 백그라운드 실행
#### 프로세스 확인 및 종료
```
# 실행 중인 Java 프로세스 확인
ps aux | grep java

# 또는
jps

# top을 사용해도 프로세스 확인 가능
top

# 프로세스 ID 확인
ps aux | grep your-app

# 프로세스 종료
kill <PID>

# 또는 프로세스 이름으로 종료
pkill -f your-app-0.0.1-SNAPSHOT.jar
```

## systemd를 이용한 서비스 등록
- 더 안정적인 프로세스 관리를 위해 systemd 서비스로 등록 가능
1. 서비스 파일 생성:
```
sudo nano /etc/systemd/system/spring-boot.service
```
2. 서비스 설정:
```
[Unit]
Description=Spring Boot Application
After=syslog.target network.target

[Service]
Type=simple
User=ec2-user
WorkingDirectory=/home/ec2-user/app
Environment="JAVA_OPTS=-Xmx512m -Xms256m"
ExecStart=/usr/bin/java $JAVA_OPTS -jar /home/ec2-user/app/your-app-0.0.1-SNAPSHOT.jar
StandardOutput=journal
StandardError=journal
SyslogIdentifier=spring-boot
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```
- Restart=always 옵션이 있어서 죽여도 계속 다시 실행되도록 할 수 있음